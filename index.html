<!DOCTYPE html>
<html>
<head>
    <title>Formulario de Llamadas</title>
    <script type="module">
        // Importar funciones necesarias de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBQqbaFLm2DRldeIU3v3RWkSX0_1vsMrWs",
            authDomain: "tipificacion-de-llamadas.firebaseapp.com",
            projectId: "tipificacion-de-llamadas",
            storageBucket: "tipificacion-de-llamadas.appspot.com",
            messagingSenderId: "738039891529",
            appId: "1:738039891529:web:f3c6aabb640d49cbd2a198",
            measurementId: "G-TBHSZLK7C2"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Lista de nombres de agentes
        const agents = [
            "Andrea Diaz",
            "Angelica de la Rosa",
            "Carmen Herrera",
            "Daniela Pernett",
            "Alexandra Padilla",
            "Jaider Romero",
            "Katy Lopez",
            "Laura Amell",
            "Maira Carpintero",
            "Saih Alvarez",
            "Saray Aparicio",
            "Sneider Garcia",
            "Alexandra Cepeda",
            "Ana Maria Insignares",
            "Yuli Lopez"
        ];

        // Función para enviar el formulario
        function submitForm() {
            const name = document.getElementById('agent-name').value;
            const callType = document.getElementById('call-type').value;
            const details = document.getElementById('details').value;
            const observation = document.getElementById('observation').value;

            addDoc(collection(db, 'calls'), {
                name: name,
                callType: callType,
                details: details,
                observation: observation,
                timestamp: serverTimestamp()
            })
            .then(() => {
                alert('Formulario enviado exitosamente.');
                document.getElementById('form').reset();
            })
            .catch((error) => {
                alert('Error: ' + error.message);
            });
        }

        // Mostrar detalles adicionales según el tipo de llamada
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar la lista de nombres en el desplegable
            const agentSelect = document.getElementById('agent-name');
            agents.forEach(agent => {
                const option = document.createElement('option');
                option.value = agent;
                option.textContent = agent;
                agentSelect.appendChild(option);
            });

            document.getElementById('call-type').addEventListener('change', function() {
                const callType = this.value;
                const detailsContainer = document.getElementById('details-container');
                detailsContainer.innerHTML = ''; // Limpiar el contenido previo

                if (callType === 'Asignación cita') {
                    const options = [
                        'Asignación cita Ginecología (incluye procedimientos)',
                        'Asignación Cita Pami',
                        'Asignación Cita Pediatría',
                        'Asignación Cita Cardiología (incluye procedimientos)',
                        'Asignación Cita Oncología (incluye procedimientos)'
                    ];
                    const select = document.createElement('select');
                    select.id = 'details';
                    select.required = true;
                    options.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option;
                        opt.textContent = option;
                        select.appendChild(opt);
                    });
                    detailsContainer.appendChild(select);
                } else {
                    const input = document.createElement('input');
                    input.id = 'details';
                    input.type = 'text';
                    detailsContainer.appendChild(input);
                }
            });
        });
    </script>
</head>
<body>
    <div id="form">
        <h2>Formulario de Llamadas</h2>
        <form onsubmit="event.preventDefault(); submitForm();">
            <label for="agent-name">Nombre del Agente:</label>
            <select id="agent-name" required>
                <!-- La lista de nombres se cargará aquí dinámicamente -->
            </select><br>
            <label for="call-type">Tipo de Llamada:</label>
            <select id="call-type" required>
                <option value="Asignación cita">Asignación cita</option>
                <option value="Cancelación o reprogramación de Cita">Cancelación o reprogramación de Cita</option>
                <option value="Información Cita">Información Cita</option>
                <option value="Información sedes Atención">Información sedes Atención</option>
                <option value="Otro tipo de información">Otro tipo de información</option>
            </select><br>
            <div id="details-container">
                <!-- Aquí se mostrarán detalles adicionales según el tipo de llamada -->
            </div>
            <label for="observation">Observación:</label>
            <textarea id="observation" rows="5" cols="50" maxlength="1000" required></textarea><br>
            <button type="submit">Guardar</button>
        </form>
    </div>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Formulario de Llamadas</title>
    <script type="module">
        // Importar funciones necesarias de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBQqbaFLm2DRldeIU3v3RWkSX0_1vsMrWs",
            authDomain: "tipificacion-de-llamadas.firebaseapp.com",
            projectId: "tipificacion-de-llamadas",
            storageBucket: "tipificacion-de-llamadas.appspot.com",
            messagingSenderId: "738039891529",
            appId: "1:738039891529:web:f3c6aabb640d49cbd2a198",
            measurementId: "G-TBHSZLK7C2"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Función para iniciar sesión
        function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    document.getElementById('agent-name').value = user.email.split('@')[0]; // Extraer nombre del email
                    document.getElementById('login-form').style.display = 'none'; // Ocultar formulario de inicio de sesión
                    document.getElementById('form').style.display = 'block'; // Mostrar formulario de llamadas
                })
                .catch((error) => {
                    alert('Error: ' + error.message);
                });
        }

        // Función para enviar el formulario
        function submitForm() {
            const name = document.getElementById('agent-name').value;
            const callType = document.getElementById('call-type').value;
            const details = document.getElementById('details').value;
            const observation = document.getElementById('observation').value;

            addDoc(collection(db, 'calls'), {
                name: name,
                callType: callType,
                details: details,
                observation: observation,
                timestamp: serverTimestamp()
            })
            .then(() => {
                alert('Formulario enviado exitosamente.');
                document.getElementById('form').reset();
            })
            .catch((error) => {
                alert('Error: ' + error.message);
            });
        }
        
        // Mostrar detalles adicionales según el tipo de llamada
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('call-type').addEventListener('change', function() {
                const callType = this.value;
                const detailsContainer = document.getElementById('details-container');
                detailsContainer.innerHTML = ''; // Limpiar el contenido previo

                if (callType === 'Asignación cita') {
                    const options = [
                        'Asignación cita Ginecología (incluye procedimientos)',
                        'Asignación Cita Pami',
                        'Asignación Cita Pediatría',
                        'Asignación Cita Cardiología (incluye procedimientos)',
                        'Asignación Cita Oncología (incluye procedimientos)'
                    ];
                    const select = document.createElement('select');
                    select.id = 'details';
                    select.required = true;
                    options.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option;
                        opt.textContent = option;
                        select.appendChild(opt);
                    });
                    detailsContainer.appendChild(select);
                } else {
                    const input = document.createElement('input');
                    input.id = 'details';
                    input.type = 'text';
                    detailsContainer.appendChild(input);
                }
            });
        });
    </script>
</head>
<body>
    <div id="login-form">
        <h2>Iniciar sesión</h2>
        <form onsubmit="event.preventDefault(); signIn();">
            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" required><br>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" required><br>
            <button type="submit">Iniciar Sesión</button>
        </form>
    </div>

    <div id="form" style="display: none;">
        <h2>Formulario de Llamadas</h2>
        <form onsubmit="event.preventDefault(); submitForm();">
            <input type="text" id="agent-name" readonly><br>
            <label for="call-type">Tipo de Llamada:</label>
            <select id="call-type" required>
                <option value="Asignación cita">Asignación cita</option>
                <option value="Cancelación o reprogramación de Cita">Cancelación o reprogramación de Cita</option>
                <option value="Información Cita">Información Cita</option>
                <option value="Información sedes Atención">Información sedes Atención</option>
                <option value="Otro tipo de información">Otro tipo de información</option>
            </select><br>
            <div id="details-container">
                <!-- Aquí se mostrarán detalles adicionales según el tipo de llamada -->
            </div>
            <label for="observation">Observación:</label>
            <textarea id="observation" rows="5" cols="50" maxlength="1000" required></textarea><br>
            <button type="submit">Guardar</button>
        </form>
    </div>
</body>
</html>
